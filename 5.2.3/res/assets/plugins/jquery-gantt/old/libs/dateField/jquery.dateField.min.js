jQuery.fn.dateField=function(i){if(!i.inputField){console.error("You must supply an input field");return false}if(typeof(i.firstDayOfWeek)=="undefined"){i.firstDayOfWeek=Date.firstDayOfWeek}if(typeof(i.useWheel)=="undefined"){i.useWheel=true}if(typeof(i.dateFormat)=="undefined"){i.dateFormat=Date.defaultFormat}if(i.inputField.is("[readonly]")||i.inputField.is("[disabled]")){return}var g={currentDate:new Date()};g.options=i;var b=this.eq(0);var e=$("<div>").addClass("calBox");var h=$("<div>").addClass("calNavBar");var f=$("<div>").addClass("calDay");f.addClass("calFullMonth");e.append(h).append(f);if(i.isSearchField){var a=$("<div>").addClass("shortCuts").html("<span title='last quarter'>LQ</span> <span title='last month'>LM</span> <span title='this month'>M</span> <span title='last week'>LW</span> <span title='this week'>W</span> <span title='yesterday'>Y</span> <span title='today'>T</span><span title='tomorrow'>TO</span> <span title='next week'>NW</span> <span title='next month'>NM</span> <span title='this quarter'>Q</span> <span title='next quarter'>NQ</span>");a.click(function(k){var j=$(k.target);if(j.is("span")){if(!i.isSearchField){i.inputField.val(Date.parseString(j.text().trim(),i.dateFormat).format(i.dateFormat),true)}else{i.inputField.val(j.text().trim())}e.remove()}});e.append(a)}$("body").append(e);nearBestPosition(b,e);e.bringToFront();$("body").oneTime(100,"regclibodcal",function(){$("body").bind("click.dateField",function(){$(this).unbind("click.dateField");e.remove()})});g.drawCalendar=function(k){g.currentDate=k;var j=function(n){var q=new Date(n.getTime());h.empty();q.setMonth(q.getMonth()-1);var p=$("<span>").addClass("calElement noCallback prev").attr("millis",q.getTime());q.setMonth(q.getMonth()+1);var o=$("<span>").html(q.format("MMMM yyyy"));q.setMonth(q.getMonth()+1);var m=$("<span>").addClass("calElement noCallback next").attr("millis",q.getTime());h.append(p).append(o).append(m)};var l=function(n){f.empty();var p=new Date();var m=parseInt((e.width()-4-(4*7))/7)+"px";var r=new Date(n);r.setFirstDayOfThisWeek(i.firstDayOfWeek);for(var o=0;o<7;o++){var q=$("<span>").addClass("calDayHeader").attr("day",r.getDay());q.css("width",m);q.html(Date.dayAbbreviations[r.getDay()]);if(typeof(i.dayHeaderRenderer)=="function"){i.dayHeaderRenderer(q,r.getDay())}f.append(q);r.setDate(r.getDate()+1)}r=new Date(n);r.setDate(1);r.setFirstDayOfThisWeek(i.firstDayOfWeek);var o=0;while((r.getMonth()<=n.getMonth()&&r.getFullYear()<=n.getFullYear())||r.getFullYear()<n.getFullYear()||(o%7!=0)){var q=$("<span>").addClass("calElement day").attr("millis",r.getTime());q.html("<span class=dayNumber>"+r.getDate()+"</span>").css("width",m);if(r.getYear()==p.getYear()&&r.getMonth()==p.getMonth()&&r.getDate()==p.getDate()){q.addClass("today")}if(r.getYear()==n.getYear()&&r.getMonth()==n.getMonth()&&r.getDate()==n.getDate()){q.addClass("selected")}if(r.getMonth()!=n.getMonth()){q.addClass("calOutOfScope")}if(typeof(i.dayRenderer)=="function"){i.dayRenderer(q,r)}f.append(q);r.setDate(r.getDate()+1);o++}};j(k);l(k)};e.click(function(l){var k=$(l.target).closest(".calElement");if(k.size()>0){var j=new Date(parseInt(k.attr("millis")));if(k.hasClass("day")){e.remove();if(!k.is(".noCallback")){i.inputField.val(j.format(i.dateFormat)).attr("millis",j.getTime()).focus();if(typeof(i.callback)=="function"){i.callback(j)}}}else{g.drawCalendar(j)}}l.stopPropagation()});if($.event.special.mousewheel&&i.useWheel){f.mousewheel(function(j,l){var k=new Date(g.currentDate.getTime());k.setMonth(k.getMonth()+l);g.drawCalendar(k);return false})}var d=i.inputField.val();if(!d||!Date.isValid(d,i.dateFormat,true)){g.drawCalendar(new Date())}else{var c=Date.parseString(d,i.dateFormat,true);if(!i.isSearchField){i.inputField.val(c.format(i.dateFormat)).attr("millis",c.getTime())}g.drawCalendar(c)}return g};