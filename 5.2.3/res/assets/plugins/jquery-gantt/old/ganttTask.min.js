function TaskFactory(){this.build=function(c,b,e,a,d,h,i){var g=computeStart(d);var f=computeEndByDuration(g,h);return new Task(c,b,e,a,g,f,h,i)}}function Task(h,b,c,g,f,a,d,e){this.id=h;this.name=b;this.progress=0;this.description="";this.code=c;this.level=g;this.status="STATUS_UNDEFINED";this.depends="";this.canWrite=true;this.start=f;this.duration=d;this.end=a;this.startIsMilestone=false;this.endIsMilestone=false;this.collapsed=e;this.rowElement;this.ganttElement;this.master;this.assigs=[]}Task.prototype.clone=function(){var a={};for(var b in this){if(typeof(this[b])!="function"){a[b]=this[b]}}return a};Task.prototype.getAssigsString=function(){var b="";for(var d=0;d<this.assigs.length;d++){var a=this.assigs[d];var c=this.master.getResource(a.resourceId);if(c){b=b+(b==""?"":", ")+c.name}}return b};Task.prototype.createAssignment=function(e,d,a,c){var b=new Assignment(e,d,a,c);this.assigs.push(b);return b};Task.prototype.setPeriod=function(f,c){if(f instanceof Date){f=f.getTime()}if(c instanceof Date){c=c.getTime()}var r={start:this.start,end:this.end,duration:this.duration};var q=f;if(f>c){f=c}f=computeStart(f);var k=this.getSuperiors();if(k&&k.length>0){var j=0;for(var o=0;o<k.length;o++){var g=k[o];j=Math.max(j,incrementDateByWorkingDays(g.from.end,g.lag))}if(computeStart(j)!=f){return this.moveTo(j+1,false)}}var h=false;var s=new Date(f);if(this.start!=f||this.start!=q){this.start=f;h=true}var p=c;c=computeEnd(c);if(this.end!=c||this.end!=p){this.end=c;h=true}this.duration=recomputeDuration(this.start,this.end);if(!h){return true}if(!this.canWrite){this.master.setErrorOnTransaction(GanttMaster.messages.CANNOT_WRITE+"\n"+this.name,this);return false}if(this.hasExternalDep){this.master.setErrorOnTransaction(GanttMaster.messages.TASK_HAS_EXTERNAL_DEPS+"\n"+this.name,this);return false}var l=true;var u=r.duration-this.duration;var b=u>0;var a=b&&(r.start<this.start);var m=b&&(r.end>this.end);if(b){var e=this.getChildren();var t=Infinity;var d=0;for(var o=0;o<e.length;o++){ch=e[o];if(m){d=Math.max(d,ch.end)}else{t=Math.min(t,ch.start)}}if(m){this.end=Math.max(d,this.end)}else{this.start=Math.min(t,this.start)}this.duration=recomputeDuration(this.start,this.end)}else{if(this.start<this.master.minEditableDate||this.end>this.master.maxEditableDate){this.master.setErrorOnTransaction(GanttMaster.messages.CHANGE_OUT_OF_SCOPE,this);l=false}if(l&&!updateTree(this)){l=false}}if(l){var n=this.getInferiors();if(n&&n.length>0){for(var o=0;o<n.length;o++){var g=n[o];if(!g.to.canWrite){this.master.setErrorOnTransaction(GanttMaster.messages.CANNOT_WRITE+"\n"+g.to.name,g.to);break}l=g.to.moveTo(c,false);if(!l){break}}}}return l};Task.prototype.moveTo=function(b,j){if(b instanceof Date){b=b.getTime()}var d={start:this.start,end:this.end};var k=b;b=computeStart(b);if(!j&&this.startIsMilestone&&b!=this.start){this.master.setErrorOnTransaction(GanttMaster.messages.START_IS_MILESTONE,this);return false}else{if(this.hasExternalDep){this.master.setErrorOnTransaction(GanttMaster.messages.TASK_HAS_EXTERNAL_DEPS,this);return false}}var h=this.getSuperiors();if(h&&h.length>0){var e=0;for(var g=0;g<h.length;g++){var l=h[g];e=Math.max(e,incrementDateByWorkingDays(l.from.end,l.lag))}b=e+1}b=computeStart(b);var f=computeEndByDuration(b,this.duration);if(this.start!=b||this.start!=k){if(!j&&this.endIsMilestone){f=this.end;this.duration=recomputeDuration(b,f)}this.start=b;this.end=f;if(this.start<this.master.minEditableDate||this.end>this.master.maxEditableDate){this.master.setErrorOnTransaction(GanttMaster.messages.CHANGE_OUT_OF_SCOPE,this);return false}var m=d.start-this.start;var c=this.getChildren();for(var g=0;g<c.length;g++){ch=c[g];if(!ch.moveTo(ch.start-m,false)){return false}}if(!updateTree(this)){return false}var a=this.getInferiors();if(a&&a.length>0){for(var g=0;g<a.length;g++){var l=a[g];if(!l.to.canWrite){this.master.setErrorOnTransaction(GanttMaster.messages.CANNOT_WRITE+"\n"+l.to.name,l.to)}else{if(!l.to.moveTo(f,false)){return false}}}}}return true};function updateTree(b){var c;var e=b.getParent();if(!e){return true}var a=e.start;var d=e.end;if(e.start>b.start){if(e.startIsMilestone){b.master.setErrorOnTransaction(GanttMaster.messages.START_IS_MILESTONE+"\n"+e.name,b);return false}else{if(e.depends){b.master.setErrorOnTransaction(GanttMaster.messages.TASK_HAS_CONSTRAINTS+"\n"+e.name,b);return false}}a=b.start}if(e.end<b.end){if(e.endIsMilestone){b.master.setErrorOnTransaction(GanttMaster.messages.END_IS_MILESTONE+"\n"+e.name,b);return false}d=b.end}if(a!=e.start||d!=e.end){if(!e.canWrite){b.master.setErrorOnTransaction(GanttMaster.messages.CANNOT_WRITE+"\n"+e.name,b);return false}if(e.hasExternalDep){b.master.setErrorOnTransaction(GanttMaster.messages.TASK_HAS_EXTERNAL_DEPS+"\n"+e.name,b);return false}return e.setPeriod(a,d)}return true}Task.prototype.changeStatus=function(c){var e=this.getDescendant();function d(h,p,j,n,k){var l=h.status;if(p==l){return true}var r=true;h.status=p;if(h.master.cannotCloseTaskIfIssueOpen&&p=="STATUS_DONE"&&h.openIssues>0){h.master.setErrorOnTransaction(GanttMaster.messages.CANNOT_CLOSE_TASK_IF_OPEN_ISSUE+" "+h.name);return false}if(p=="STATUS_DONE"){if((j||l!="STATUS_FAILED")){var o=h.getSuperiors();for(var m=0;m<o.length;m++){if(e.indexOf(o[m].from)<0){if(o[m].from.status!="STATUS_DONE"){if(j||n){h.master.setErrorOnTransaction(GanttMaster.messages.GANTT_ERROR_DEPENDS_ON_OPEN_TASK+"\n"+o[m].from.name+" -> "+h.name)}r=false;break}}}if(r){var s=h.getChildren();for(var m=0;m<s.length;m++){d(s[m],"STATUS_DONE",false,true,false)}f(e,h.getInferiors(),"STATUS_ACTIVE")}}else{r=false}}else{if(p=="STATUS_ACTIVE"){if((j||l!="STATUS_FAILED")){var q=h.getParent();if(q&&q.status!="STATUS_ACTIVE"){r=d(q,"STATUS_ACTIVE",false,false,true)}if(r){var o=h.getSuperiors();for(var m=0;m<o.length;m++){if(o[m].from.status!="STATUS_DONE"){if(j||k){h.master.setErrorOnTransaction(GanttMaster.messages.GANTT_ERROR_DEPENDS_ON_OPEN_TASK+"\n"+o[m].from.name+" -> "+h.name)}r=false;break}}}if(r){var s=h.getChildren();if(l=="STATUS_UNDEFINED"||l=="STATUS_SUSPENDED"){for(var m=0;m<s.length;m++){if(s[m].status!="STATUS_DONE"){d(s[m],"STATUS_ACTIVE",false,true,false)}}}var g=h.getInferiors();for(var m=0;m<g.length;m++){d(g[m].to,"STATUS_SUSPENDED",false,false,false)}}}else{r=false}}else{if(p=="STATUS_SUSPENDED"||p=="STATUS_UNDEFINED"){if(j||l!="STATUS_FAILED"){var q=h.getParent();if(q&&q.status!="STATUS_ACTIVE"){r=d(q,p,false,false,true)}var s=h.getChildren();for(var m=0;m<s.length;m++){if(s[m].status!="STATUS_DONE"){d(s[m],p,false,true,false)}}f(e,h.getInferiors(),p)}else{r=false}}else{if(p=="STATUS_FAILED"){var s=h.getChildren();for(var m=0;m<s.length;m++){d(s[m],"STATUS_FAILED",false,true,false)}f(e,h.getInferiors(),"STATUS_FAILED")}}}}if(!r){h.status=l}return r}function f(k,j,g){for(var h=0;h<j.length;h++){if(k.indexOf(j[h].to)<0){d(j[h].to,g,false,false,false)}}}var b=true;var a=this.status;b=d(this,c,true,false,false);if(!b){this.status=a}return b};Task.prototype.synchronizeStatus=function(){var a=this.status;this.status="";return this.changeStatus(a)};Task.prototype.isLocallyBlockedByDependencies=function(){var c=this.getSuperiors();var a=false;for(var b=0;b<c.length;b++){if(c[b].from.status!="STATUS_DONE"){a=true;break}}return a};Task.prototype.getRow=function(){ret=-1;if(this.master){ret=this.master.tasks.indexOf(this)}return ret};Task.prototype.getParents=function(){var b;if(this.master){var a=this.level;var e=this.getRow();b=[];for(var c=e;c>=0;c--){var d=this.master.tasks[c];if(a>d.level){a=d.level;b.push(d)}}}return b};Task.prototype.getParent=function(){var a;if(this.master){for(var b=this.getRow();b>=0;b--){var c=this.master.tasks[b];if(this.level>c.level){a=c;break}}}return a};Task.prototype.isParent=function(){var a=false;if(this.master){var b=this.getRow();if(b<this.master.tasks.length-1){a=this.master.tasks[b+1].level>this.level}}return a};Task.prototype.getChildren=function(){var a=[];if(this.master){var d=this.getRow();for(var b=d+1;b<this.master.tasks.length;b++){var c=this.master.tasks[b];if(c.level==this.level+1){a.push(c)}else{if(c.level<=this.level){break}}}}return a};Task.prototype.getDescendant=function(){var a=[];if(this.master){var d=this.getRow();for(var b=d+1;b<this.master.tasks.length;b++){var c=this.master.tasks[b];if(c.level>this.level){a.push(c)}else{break}}}return a};Task.prototype.getSuperiors=function(){var b=[];var a=this;if(this.master){b=this.master.links.filter(function(c){return c.to==a})}return b};Task.prototype.getSuperiorTasks=function(){var a=[];var c=this.getSuperiors();for(var b=0;b<c.length;b++){a.push(c[b].from)}return a};Task.prototype.getInferiors=function(){var b=[];var a=this;if(this.master){b=this.master.links.filter(function(c){return c.from==a})}return b};Task.prototype.getInferiorTasks=function(){var a=[];var c=this.getInferiors();for(var b=0;b<c.length;b++){a.push(c[b].to)}return a};Task.prototype.deleteTask=function(){this.rowElement.remove();this.ganttElement.remove();var c=this.getChildren();for(var b=0;b<c.length;b++){if(!c[b].isNew()){this.master.deletedTaskIds.push(c[b].id)}c[b].deleteTask()}if(!this.isNew()){this.master.deletedTaskIds.push(this.id)}this.master.tasks.splice(this.getRow(),1);var a=this;this.master.links=this.master.links.filter(function(d){return d.from!=a&&d.to!=a})};Task.prototype.isNew=function(){return(this.id+"").indexOf("tmp_")==0};Task.prototype.isDependent=function(c){var a=this;var d=this.master.links.filter(function(e){return e.from==a});for(var b=0;b<d.length;b++){if(d[b].to==c){return true}}for(var b=0;b<d.length;b++){if(d[b].to.isDependent(c)){return true}}return false};Task.prototype.setLatest=function(a){this.latestStart=a-this.criticalCost;this.latestFinish=this.latestStart+this.duration};Task.prototype.indent=function(){var j=this.getRow();if(j<=0){return false}var f=false;var e=this.master.tasks[j-1];var a=this.level+1;if(a<=e.level+1){f=true;this.level++;var k=this.getParents();this.level--;var b=this.level;for(var c=j;c<this.master.tasks.length;c++){var d=this.master.tasks[c];if(d.level>b||d==this){d.level++;this.master.links=this.master.links.filter(function(i){var l=false;if(i.to==d){l=k.indexOf(i.from)>=0}else{if(i.from==d){l=k.indexOf(i.to)>=0}}return !l})}else{break}}var h=this.getParent();if(h&&!this.depends){var g=computeEndByDuration(h.start,this.duration);this.master.changeTaskDates(this,h.start,g)}this.master.updateDependsStrings();this.setPeriod(this.start+1,this.end+1);this.synchronizeStatus()}return f};Task.prototype.outdent=function(){if(this.level<=1){return false}var b=false;var d=this.level;b=true;var g=this.getRow();for(var c=g;c<this.master.tasks.length;c++){var f=this.master.tasks[c];if(f.level>d||f==this){f.level--}else{break}}var a=this;var e=this.getChildren();this.master.links=this.master.links.filter(function(i){var h=(i.to==a&&e.indexOf(i.from)>=0||i.from==a&&e.indexOf(i.to)>=0);return !h});for(var c=0;c<e.length;c++){e[c].setPeriod(e[c].start+1,e[c].end+1)}this.master.updateDependsStrings();this.setPeriod(this.start+1,this.end+1);this.synchronizeStatus();return b};Task.prototype.moveUp=function(){var d=false;var k=this.getRow();if(k<=0){return false}var h;for(h=k-1;h>=0;h--){if(this.master.tasks[h].level<=this.level){break}}if(this.master.tasks[h].level==this.level){d=true;var b=0;for(var a=k+1;a<this.master.tasks.length;a++){var c=this.master.tasks[a];if(c.level>this.level){b++}else{break}}var e=this.master.tasks.splice(k,b+1);var f=this.master.tasks.splice(0,h);this.master.tasks=[].concat(f,e,this.master.tasks);var j=this.master.editor.element.find("tr[taskId]");var g=j.slice(k,k+b+1);j.eq(h).before(g);this.master.updateDependsStrings()}else{this.master.setErrorOnTransaction(GanttMaster.messages.TASK_MOVE_INCONSISTENT_LEVEL,this);d=false}return d};Task.prototype.moveDown=function(){var l=this.getRow();if(l>=this.master.tasks.length-1||l==0){return false}var e=false;var j;for(j=l+1;j<this.master.tasks.length;j++){if(this.master.tasks[j].level<=this.level){break}}if(this.master.tasks[j]&&this.master.tasks[j].level==this.level){e=true;for(j=j+1;j<this.master.tasks.length;j++){if(this.master.tasks[j].level<=this.level){break}}var b=0;for(var a=l+1;a<this.master.tasks.length;a++){var d=this.master.tasks[a];if(d.level>this.level){b++}else{break}}var f=this.master.tasks.splice(l,b+1);var g=this.master.tasks.splice(0,j-b-1);this.master.tasks=[].concat(g,f,this.master.tasks);var k=this.master.editor.element.find("tr[taskId]");var c=k.eq(j-1);var h=k.slice(l,l+b+1);c.after(h);this.master.updateDependsStrings()}return e};function Link(c,b,a){this.from=c;this.to=b;this.lag=a}function Assignment(d,c,a,b){this.id=d;this.resourceId=c;this.roleId=a;this.effort=b}function Resource(b,a){this.id=b;this.name=a}function Role(b,a){this.id=b;this.name=a};