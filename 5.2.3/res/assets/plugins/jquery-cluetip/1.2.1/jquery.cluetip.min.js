/*!
 * jQuery clueTip plugin v1.2.1
 *
 * Date: Mon Jul 18 11:21:34 2011 EDT
 * Requires: jQuery v1.3+
 *
 * Copyright 2011, Karl Swedberg
 * Dual licensed under the MIT and GPL licenses:
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl.html
 *
 *
 * Examples can be found at http://plugins.learningjquery.com/cluetip/demo/
 *
*/
(function(d){d.cluetip={version:"1.2.1",template:["<div>",'<div class="cluetip-outer">','<h3 class="cluetip-title ui-widget-header ui-cluetip-header"></h3>','<div class="cluetip-inner ui-widget-content ui-cluetip-content"></div>',"</div>",'<div class="cluetip-extra"></div>','<div class="cluetip-arrows ui-state-default"></div>',"</div>"].join(""),setup:{insertionType:"appendTo",insertionElement:"body"},defaults:{multiple:false,width:275,height:"auto",cluezIndex:97,positionBy:"auto",topOffset:15,leftOffset:15,local:false,localPrefix:null,localIdSuffix:null,hideLocal:true,attribute:"rel",titleAttribute:"title",splitTitle:"",escapeTitle:false,showTitle:true,cluetipClass:"default",hoverClass:"",waitImage:true,cursor:"help",arrows:false,dropShadow:true,dropShadowSteps:6,sticky:false,mouseOutClose:false,activation:"hover",clickThrough:true,tracking:false,delayedClose:0,closePosition:"top",closeText:"Close",truncate:0,fx:{open:"show",openSpeed:""},hoverIntent:{sensitivity:3,interval:50,timeout:0},onActivate:function(f){return true},onShow:function(g,f){},onHide:function(g,f){},ajaxCache:true,ajaxProcess:function(f){f=f.replace(/<(script|style|title)[^<]+<\/(script|style|title)>/gm,"").replace(/<(link|meta)[^>]+>/g,"");return f},ajaxSettings:{dataType:"html"},debug:false}};var e,a="cluetip ui-widget ui-widget-content ui-cluetip",b=0,c=0;d.fn.attrProp=d.fn.prop||d.fn.attr;d.fn.cluetip=function(i,v){var r,n,m,j,l,t;if(typeof i=="object"){v=i;i=null}if(i=="destroy"){var k=this.data("cluetip");if(k){d(k.selector).remove();d.removeData(this,"title");d.removeData(this,"cluetip");d(document).unbind(".cluetip");return this.unbind(".cluetip")}}v=d.extend(true,{},d.cluetip.defaults,v||{});b++;var h=d.cluetip.backCompat||!v.multiple?"cluetip":"cluetip-"+b,q="#"+h,o=d.cluetip.backCompat?"#":".",g=d.cluetip.setup.insertionType,f=d.cluetip.setup.insertionElement||"body";g=(/appendTo|prependTo|insertBefore|insertAfter/).test(g)?g:"appendTo";r=d(q);if(!r.length){r=d(d.cluetip.template)[g](f).attr("id",h).css({position:"absolute",display:"none"});var u=+v.cluezIndex;m=r.find(o+"cluetip-outer").css({position:"relative",zIndex:u});n=r.find(o+"cluetip-inner");j=r.find(o+"cluetip-title")}e=d("#cluetip-waitimage");if(!e.length){e=d("<div></div>").attr("id","cluetip-waitimage").css({position:"absolute"})}e.insertBefore(r).hide();var s=(parseInt(r.css("paddingLeft"),10)||0)+(parseInt(r.css("paddingRight"),10)||0);this.each(function(R){var C=this,I=d(this),P=d.extend(true,{},v,d.metadata?I.metadata():d.meta?I.data():I.data("cluetip")||{}),y=false,Z=false,Y=0,N=P[P.attribute]||I.attrProp(P.attribute)||I.attr(P.attribute),B=P.cluetipClass;u=+P.cluezIndex;I.data("cluetip",{title:C.title,zIndex:u,selector:q});if(!N&&!P.splitTitle&&!i){return true}if(P.local&&P.localPrefix){N=P.localPrefix+N}if(P.local&&P.hideLocal&&N){d(N+":first").hide()}var O=parseInt(P.topOffset,10),K=parseInt(P.leftOffset,10);var J,aa,G=isNaN(parseInt(P.height,10))?"auto":(/\D/g).test(P.height)?P.height:P.height+"px";var w,D,S,af,U,ab;var H=parseInt(P.width,10)||275,ac=H+s+P.dropShadowSteps,L=this.offsetWidth,E,T,ag,V,x;var X;var Q=(P.attribute!="title")?I.attrProp(P.titleAttribute):"";if(P.splitTitle){if(Q==undefined){Q=""}X=Q.split(P.splitTitle);Q=X.shift()}if(P.escapeTitle){Q=Q.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;")}var A;function ae(){return false}var F=function(ah){var an=P.onActivate(I);if(an===false){return false}Z=true;r=d(q).css({position:"absolute"});m=r.find(o+"cluetip-outer");n=r.find(o+"cluetip-inner");j=r.find(o+"cluetip-title");l=r.find(o+"cluetip-arrows");r.removeClass().css({width:H});if(N==I.attr("href")){I.css("cursor",P.cursor)}if(P.hoverClass){I.addClass(P.hoverClass)}D=S=I.offset().top;E=I.offset().left;L=I.innerWidth();if(ah.type==focus){V=E+(L/2)+K;r.css({left:T});U=S+O}else{V=ah.pageX;U=ah.pageY}if(C.tagName.toLowerCase()!="area"){w=d(document).scrollTop();x=d(window).width()}if(P.positionBy=="fixed"){T=L+E+K;r.css({left:T})}else{T=(L>E&&E>ac)||E+L+ac+K>x?E-ac-K:L+E+K;if(C.tagName.toLowerCase()=="area"||P.positionBy=="mouse"||L+ac>x){if(V+20+ac>x){r.addClass(" cluetip-"+B);T=(V-ac-K)>=0?V-ac-K-parseInt(r.css("marginLeft"),10)+parseInt(n.css("marginRight"),10):V-(ac/2)}else{T=V+K}}var ai=T<0?ah.pageY+O:ah.pageY;r.css({left:(T>0&&P.positionBy!="bottomTop")?T:(V+(ac/2)>x)?x/2-ac/2:Math.max(V-(ac/2),0),zIndex:I.data("cluetip").zIndex});l.css({zIndex:I.data("cluetip").zIndex+1})}aa=d(window).height();if(i){if(typeof i=="function"){i=i.call(C)}n.html(i);W(ai)}else{if(X){var ak=X.length;n.html(ak?X[0]:"");if(ak>1){for(var aj=1;aj<ak;aj++){n.append('<div class="split-body">'+X[aj]+"</div>")}}W(ai)}else{if(!P.local&&N.indexOf("#")!==0){if(/\.(jpe?g|tiff?|gif|png)(?:\?.*)?$/i.test(N)){n.html('<img src="'+N+'" alt="'+Q+'" />');W(ai)}else{var ap=P.ajaxSettings.beforeSend,al=P.ajaxSettings.error,am=P.ajaxSettings.success,at=P.ajaxSettings.complete;var ar={cache:P.ajaxCache,url:N,beforeSend:function(av,au){if(ap){ap.call(C,av,r,n,au)}m.children().empty();if(P.waitImage){e.css({top:U+20,left:V+20,zIndex:I.data("cluetip").zIndex-1}).show()}},error:function(au,av){if(Z){if(al){al.call(C,au,av,r,n)}else{n.html("<i>sorry, the contents could not be loaded</i>")}}},success:function(au,av){y=P.ajaxProcess.call(C,au);if(Z){if(am){am.call(C,au,av,r,n)}n.html(y)}},complete:function(aw,ay){if(at){at.call(C,aw,ay,r,n)}var ax=n[0].getElementsByTagName("img");c=ax.length;for(var av=0,au=ax.length;av<au;av++){if(ax[av].complete){c--}}if(c&&!d.browser.opera){d(ax).bind("load error",function(){c--;if(c<1){e.hide();if(Z){W(ai)}}})}else{e.hide();if(Z){W(ai)}}}};var ao=d.extend(true,{},P.ajaxSettings,ar);d.ajax(ao)}}else{if(P.local){var aq=d(N+(/#\S+$/.test(N)?"":":eq("+R+")")).clone(true).show();if(P.localIdSuffix){aq.attr("id",aq[0].id+P.localIdSuffix)}n.html(aq);W(ai)}}}}};var W=function(ak){var ai,aj,an,ao="",am="";r.addClass("cluetip-"+B);if(P.truncate){var al=n.text().slice(0,P.truncate)+"...";n.html(al)}function ah(){}Q?j.show().html(Q):(P.showTitle)?j.show().html("&nbsp;"):j.hide();if(P.sticky){ai=d('<div class="cluetip-close"><a href="#">'+P.closeText+"</a></div>");(P.closePosition=="bottom")?ai.appendTo(n):(P.closePosition=="title")?ai.prependTo(j):ai.prependTo(n);ai.bind("click.cluetip",function(){M();return false});if(P.mouseOutClose){r.bind("mouseleave.cluetip",function(){M()})}else{r.unbind("mouseleave.cluetip")}}m.css({zIndex:I.data("cluetip").zIndex,overflow:G=="auto"?"visible":"auto",height:G});J=G=="auto"?Math.max(r.outerHeight(),r.height()):parseInt(G,10);af=S;ab=w+aa;if(P.positionBy=="fixed"){af=S-P.dropShadowSteps+O}else{if((T<V&&Math.max(T,0)+ac>V)||P.positionBy=="bottomTop"){if(S+J+O>ab&&U-w>J+O){af=U-J-O;am="top"}else{af=U+O;am="bottom"}}else{if(S+J+O>ab){af=(J>=aa)?w:ab-J-O}else{if(I.css("display")=="block"||C.tagName.toLowerCase()=="area"||P.positionBy=="mouse"){af=ak-O}else{af=S-P.dropShadowSteps}}}}if(am==""){T<E?am="left":am="right"}aj=" clue-"+am+"-"+B+" cluetip-"+B;if(B=="rounded"){aj+=" ui-corner-all"}r.css({top:af+"px"}).attrProp({className:a+aj});if(P.arrows){if(/(left|right)/.test(am)){an=r.height()-l.height();ao=T>=0&&ak>0?(S-af-P.dropShadowSteps):0;ao=an>ao?ao:an;ao+="px"}l.css({top:ao}).show()}else{l.hide()}t=p(r,P);if(t&&t.length){t.hide().css({height:J,width:H,zIndex:I.data("cluetip").zIndex-1}).show()}r.hide()[P.fx.open](P.fx.openSpeed||0);if(d.fn.bgiframe){r.bgiframe()}if(P.delayedClose>0){Y=setTimeout(M,P.delayedClose)}P.onShow.call(C,r,n)};var ad=function(ah){Z=false;e.hide();if(!P.sticky||(/click|toggle/).test(P.activation)){M();clearTimeout(Y)}if(P.hoverClass){I.removeClass(P.hoverClass)}};var M=function(am){var ai=am&&am.data("cluetip")?am:I,ak=ai.data("cluetip").selector,al=d(ak),ah=al.find(o+"cluetip-inner"),aj=al.find(o+"cluetip-arrows");al.hide().removeClass();P.onHide.call(ai[0],al,ah);ai.removeClass("cluetip-clicked");if(Q){ai.attrProp(P.titleAttribute,Q)}ai.css("cursor","");if(P.arrows){aj.css({top:""})}};d(document).unbind("hideCluetip.cluetip").bind("hideCluetip.cluetip",function(ah){M(d(ah.target))});if((/click|toggle/).test(P.activation)){I.bind("click.cluetip",function(ah){if(r.is(":hidden")||!I.is(".cluetip-clicked")){F(ah);d(".cluetip-clicked").removeClass("cluetip-clicked");I.addClass("cluetip-clicked")}else{ad(ah)}return false})}else{if(P.activation=="focus"){I.bind("focus.cluetip",function(ah){I.attrProp("title","");F(ah)});I.bind("blur.cluetip",function(ah){I.attrProp("title",I.data("cluetip").title);ad(ah)})}else{I[P.clickThrough?"unbind":"bind"]("click.cluetip",ae);var z=function(ah){if(P.tracking==true){var aj=T-ah.pageX;var ai=af?af-ah.pageY:S-ah.pageY;I.bind("mousemove.cluetip",function(ak){r.css({left:ak.pageX+aj,top:ak.pageY+ai})})}};if(d.fn.hoverIntent&&P.hoverIntent){I.hoverIntent({sensitivity:P.hoverIntent.sensitivity,interval:P.hoverIntent.interval,over:function(ah){F(ah);z(ah)},timeout:P.hoverIntent.timeout,out:function(ah){ad(ah);I.unbind("mousemove.cluetip")}})}else{I.bind("mouseenter.cluetip",function(ah){F(ah);z(ah)}).bind("mouseleave.cluetip",function(ah){ad(ah);I.unbind("mousemove.cluetip")})}I.bind("mouseover.cluetip",function(ah){I.attrProp("title","")}).bind("mouseleave.cluetip",function(ah){I.attrProp("title",I.data("cluetip").title)})}}});function p(C,z,D){var y=(z.dropShadow&&z.dropShadowSteps)?+z.dropShadowSteps:0;if(d.support.boxShadow){var x=y===0?"0 0 ":"1px 1px ";C.css(d.support.boxShadow,x+y+"px rgba(0,0,0,0.5)");return false}var w=C.find("cluetip-drop-shadow");if(y==w.length){return w}w.remove();var B=[];for(var A=0;A<y;){B[A++]='<div style="top:'+A+"px;left:"+A+'px;"></div>'}D=d(B.join("")).css({position:"absolute",backgroundColor:"#000",zIndex:u-1,opacity:0.1}).addClass("cluetip-drop-shadow").prependTo("#cluetip");return D}return this};(function(){d.support=d.support||{};var f=document.createElement("div"),h=f.style,q=["boxShadow"],o=["moz","Moz","webkit","o"];for(var p=0,l=q.length;p<l;p++){var g=q[p],k=g.charAt(0).toUpperCase()+g.slice(1);if(typeof h[g]!=="undefined"){d.support[g]=g}else{for(var n=0,m=o.length;n<m;n++){if(typeof h[o[n]+k]!=="undefined"){d.support[g]=o[n]+k;break}}}}f=null})();d.fn.cluetip.defaults=d.cluetip.defaults})(afw.jQuery);