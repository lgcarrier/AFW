module.exports=function(a){a.initConfig({pkg:a.file.readJSON("package.json"),concat:{dist:{src:["src/<%= pkg.name %>.js","src/<%= pkg.name %>.*.js","src/vakata-jstree.js"],dest:"dist/<%= pkg.name %>.js"}},copy:{libs:{files:[{expand:true,cwd:"libs/",src:["*"],dest:"dist/libs/"}]},docs:{files:[{expand:true,cwd:"dist/",src:["**/*"],dest:"docs/assets/dist/"}]}},uglify:{options:{banner:'/*! <%= pkg.title || pkg.name %> - v<%= pkg.version %> - <%= grunt.template.today("yyyy-mm-dd") %> - (<%= _.pluck(pkg.licenses, "type").join(", ") %>) */\n',preserveComments:false,report:"min",beautify:{ascii_only:true},compress:{hoist_funs:false,loops:false,unused:false}},dist:{src:["<%= concat.dist.dest %>"],dest:"dist/<%= pkg.name %>.min.js"}},qunit:{files:["test/unit/**/*.html"]},jshint:{options:{curly:true,eqeqeq:true,latedef:true,newcap:true,noarg:true,sub:true,undef:true,boss:true,eqnull:true,browser:true,trailing:true,globals:{console:true,jQuery:true,browser:true,XSLTProcessor:true,ActiveXObject:true}},beforeconcat:["src/<%= pkg.name %>.js","src/<%= pkg.name %>.*.js"],afterconcat:["dist/<%= pkg.name %>.js"]},dox:{files:{src:["src/*.js"],dest:"docs"}},amd:{files:{src:["dist/jstree.js"],dest:"dist/jstree.js"}},less:{production:{options:{cleancss:true,compress:true},files:{"dist/themes/default/style.min.css":"src/themes/default/style.less","dist/themes/default-dark/style.min.css":"src/themes/default-dark/style.less"}},development:{files:{"src/themes/default/style.css":"src/themes/default/style.less","dist/themes/default/style.css":"src/themes/default/style.less","src/themes/default-dark/style.css":"src/themes/default-dark/style.less","dist/themes/default-dark/style.css":"src/themes/default-dark/style.less"}}},watch:{js:{files:["src/**/*.js"],tasks:["js"],options:{atBegin:true}},css:{files:["src/**/*.less","src/**/*.png","src/**/*.gif"],tasks:["css"],options:{atBegin:true}}},"phantomcss-gitdiff":{options:{baseUrl:"http://127.0.0.1/jstree/",serverRoot:"test/visual/",gitDiff:true},desktop:{options:{screenshots:"test/visual/screenshots/",failures:"test/visual/failures/",viewportSize:[1280,800]},src:["test/visual/d.html"]},mobile:{options:{screenshots:"test/visual/screenshots/",failures:"test/visual/failures/",viewportSize:[360,800]},src:["test/visual/m.html"]}},imagemin:{dynamic:{options:{optimizationLevel:7,pngquant:true},files:[{expand:true,cwd:"src/themes/default/",src:["**/*.{png,jpg,gif}"],dest:"dist/themes/default/"},{expand:true,cwd:"src/themes/default-dark/",src:["**/*.{png,jpg,gif}"],dest:"dist/themes/default-dark/"}]}},replace:{files:{src:["dist/*.js","bower.json","component.json","jstree.jquery.json"],overwrite:true,replacements:[{from:"{{VERSION}}",to:"<%= pkg.version %>"},{from:/"version": "[^"]+"/g,to:'"version": "<%= pkg.version %>"'}]}}});a.loadNpmTasks("grunt-contrib-jshint");a.loadNpmTasks("grunt-contrib-concat");a.loadNpmTasks("grunt-contrib-copy");a.loadNpmTasks("grunt-contrib-uglify");a.loadNpmTasks("grunt-contrib-less");a.loadNpmTasks("grunt-contrib-qunit");a.loadNpmTasks("grunt-phantomcss-gitdiff");a.loadNpmTasks("grunt-contrib-watch");a.loadNpmTasks("grunt-contrib-imagemin");a.loadNpmTasks("grunt-text-replace");a.registerMultiTask("amd","Clean up AMD",function(){var b,c;this.files.forEach(function(d){b=d.src;c=d.dest});a.file.copy(b,c,{process:function(d){d=d.replace(/\s*if\(\$\.jstree\.plugins\.[a-z]+\)\s*\{\s*return;\s*\}/ig,"");d=d.replace(/\/\*globals[^\/]+\//ig,"");d=d.replace(/\(function \(factory[\s\S]*?undefined[^\n]+/mig,"");d=d.replace(/\}\)\);/g,"");d=d.replace(/\s*("|')use strict("|');/g,"");return a.file.read("src/intro.js")+d+a.file.read("src/outro.js")}})});a.registerMultiTask("dox","Generate dox output ",function(){var c=require("child_process").exec,f=require("path"),b=this.async(),e=f.resolve(__dirname),d=[e,"node_modules",".bin","dox"].join(f.sep);c(d+' < "dist/jstree.js" > "docs/jstree.json"',{maxBuffer:5000*1024},function(g,h,i){if(g){a.log.error(d);a.log.error("WARN: "+g)}if(!g){a.log.writeln("dist/jstree.js doxxed.");b()}})});a.registerTask("default",["jshint:beforeconcat","concat","amd","jshint:afterconcat","copy:libs","uglify","less","imagemin","replace","copy:docs","qunit","phantomcss-gitdiff","dox"]);a.registerTask("js",["concat","amd","uglify"]);a.registerTask("css",["copy","less"])};