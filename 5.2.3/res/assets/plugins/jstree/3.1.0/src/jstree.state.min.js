(function(a){if(typeof define==="function"&&define.amd){define("jstree.state",["jquery","jstree"],a)}else{if(typeof exports==="object"){a(require("jquery"),require("jstree"))}else{a(jQuery,jQuery.jstree)}}}(function(b,a,c){if(b.jstree.plugins.state){return}var d=false;b.jstree.defaults.state={key:"jstree",events:"changed.jstree open_node.jstree close_node.jstree check_node.jstree uncheck_node.jstree",ttl:false,filter:false};b.jstree.plugins.state=function(e,f){this.bind=function(){f.bind.call(this);var g=b.proxy(function(){this.element.on(this.settings.state.events,b.proxy(function(){if(d){clearTimeout(d)}d=setTimeout(b.proxy(function(){this.save_state()},this),100)},this));this.trigger("state_ready")},this);this.element.on("ready.jstree",b.proxy(function(i,h){this.element.one("restore_state.jstree",g);if(!this.restore_state()){g()}},this))};this.save_state=function(){var g={state:this.get_state(),ttl:this.settings.state.ttl,sec:+(new Date())};b.vakata.storage.set(this.settings.state.key,JSON.stringify(g))};this.restore_state=function(){var g=b.vakata.storage.get(this.settings.state.key);if(!!g){try{g=JSON.parse(g)}catch(h){return false}}if(!!g&&g.ttl&&g.sec&&+(new Date())-g.sec>g.ttl){return false}if(!!g&&g.state){g=g.state}if(!!g&&b.isFunction(this.settings.state.filter)){g=this.settings.state.filter.call(this,g)}if(!!g){this.element.one("set_state.jstree",function(j,i){i.instance.trigger("restore_state",{state:b.extend(true,{},g)})});this.set_state(g);return true}return false};this.clear_state=function(){return b.vakata.storage.del(this.settings.state.key)}};(function(e,f){e.vakata.storage={set:function(g,h){return window.localStorage.setItem(g,h)},get:function(g){return window.localStorage.getItem(g)},del:function(g){return window.localStorage.removeItem(g)}}}(b))}));