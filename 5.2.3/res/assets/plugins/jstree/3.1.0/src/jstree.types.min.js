(function(a){if(typeof define==="function"&&define.amd){define("jstree.types",["jquery","jstree"],a)}else{if(typeof exports==="object"){a(require("jquery"),require("jstree"))}else{a(jQuery,jQuery.jstree)}}}(function(b,a,c){if(b.jstree.plugins.types){return}b.jstree.defaults.types={"#":{},"default":{}};b.jstree.plugins.types=function(d,e){this.init=function(k,g){var h,f;if(g&&g.types&&g.types["default"]){for(h in g.types){if(h!=="default"&&h!=="#"&&g.types.hasOwnProperty(h)){for(f in g.types["default"]){if(g.types["default"].hasOwnProperty(f)&&g.types[h][f]===c){g.types[h][f]=g.types["default"][f]}}}}}e.init.call(this,k,g);this._model.data["#"].type="#"};this.refresh=function(g,f){e.refresh.call(this,g,f);this._model.data["#"].type="#"};this.bind=function(){this.element.on("model.jstree",b.proxy(function(n,l){var f=this._model.data,p=l.nodes,k=this.settings.types,h,g,o="default";for(h=0,g=p.length;h<g;h++){o="default";if(f[p[h]].original&&f[p[h]].original.type&&k[f[p[h]].original.type]){o=f[p[h]].original.type}if(f[p[h]].data&&f[p[h]].data.jstree&&f[p[h]].data.jstree.type&&k[f[p[h]].data.jstree.type]){o=f[p[h]].data.jstree.type}f[p[h]].type=o;if(f[p[h]].icon===true&&k[o].icon!==c){f[p[h]].icon=k[o].icon}}f["#"].type="#"},this));e.bind.call(this)};this.get_json=function(o,h,p){var n,g,f=this._model.data,l=h?b.extend(true,{},h,{no_id:false}):{},k=e.get_json.call(this,o,l,p);if(k===false){return false}if(b.isArray(k)){for(n=0,g=k.length;n<g;n++){k[n].type=k[n].id&&f[k[n].id]&&f[k[n].id].type?f[k[n].id].type:"default";if(h&&h.no_id){delete k[n].id;if(k[n].li_attr&&k[n].li_attr.id){delete k[n].li_attr.id}if(k[n].a_attr&&k[n].a_attr.id){delete k[n].a_attr.id}}}}else{k.type=k.id&&f[k.id]&&f[k.id].type?f[k.id].type:"default";if(h&&h.no_id){k=this._delete_ids(k)}}return k};this._delete_ids=function(h){if(b.isArray(h)){for(var g=0,f=h.length;g<f;g++){h[g]=this._delete_ids(h[g])}return h}delete h.id;if(h.li_attr&&h.li_attr.id){delete h.li_attr.id}if(h.a_attr&&h.a_attr.id){delete h.a_attr.id}if(h.children&&b.isArray(h.children)){h.children=this._delete_ids(h.children)}return h};this.check=function(q,k,o,r,p){if(e.check.call(this,q,k,o,r,p)===false){return false}k=k&&k.id?k:this.get_node(k);o=o&&o.id?o:this.get_node(o);var f=k&&k.id?(p&&p.origin?p.origin:b.jstree.reference(k.id)):null,l,n,h,g;f=f&&f._model&&f._model.data?f._model.data:null;switch(q){case"create_node":case"move_node":case"copy_node":if(q!=="move_node"||b.inArray(k.id,o.children)===-1){l=this.get_rules(o);if(l.max_children!==c&&l.max_children!==-1&&l.max_children===o.children.length){this._data.core.last_error={error:"check",plugin:"types",id:"types_01",reason:"max_children prevents function: "+q,data:JSON.stringify({chk:q,pos:r,obj:k&&k.id?k.id:false,par:o&&o.id?o.id:false})};return false}if(l.valid_children!==c&&l.valid_children!==-1&&b.inArray((k.type||"default"),l.valid_children)===-1){this._data.core.last_error={error:"check",plugin:"types",id:"types_02",reason:"valid_children prevents function: "+q,data:JSON.stringify({chk:q,pos:r,obj:k&&k.id?k.id:false,par:o&&o.id?o.id:false})};return false}if(f&&k.children_d&&k.parents){n=0;for(h=0,g=k.children_d.length;h<g;h++){n=Math.max(n,f[k.children_d[h]].parents.length)}n=n-k.parents.length+1}if(n<=0||n===c){n=1}do{if(l.max_depth!==c&&l.max_depth!==-1&&l.max_depth<n){this._data.core.last_error={error:"check",plugin:"types",id:"types_03",reason:"max_depth prevents function: "+q,data:JSON.stringify({chk:q,pos:r,obj:k&&k.id?k.id:false,par:o&&o.id?o.id:false})};return false}o=this.get_node(o.parent);l=this.get_rules(o);n++}while(o)}break}return true};this.get_rules=function(g){g=this.get_node(g);if(!g){return false}var f=this.get_type(g,true);if(f.max_depth===c){f.max_depth=-1}if(f.max_children===c){f.max_children=-1}if(f.valid_children===c){f.valid_children=-1}return f};this.get_type=function(f,g){f=this.get_node(f);return(!f)?false:(g?b.extend({type:f.type},this.settings.types[f.type]):f.type)};this.set_type=function(l,j){var h,k,i,g,f;if(b.isArray(l)){l=l.slice();for(k=0,i=l.length;k<i;k++){this.set_type(l[k],j)}return true}h=this.settings.types;l=this.get_node(l);if(!h[j]||!l){return false}g=l.type;f=this.get_icon(l);l.type=j;if(f===true||(h[g]&&h[g].icon!==c&&f===h[g].icon)){this.set_icon(l,h[j].icon!==c?h[j].icon:true)}return true}}}));